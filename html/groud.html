<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跳蚤广场</title>
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.11/lib/index.css" />

    <!-- 引入 Vue 和 Vant 的 JS 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vant@2.11/lib/vant.min.js"></script>
    <!-- 引入axios的JS文件 -->
    <script src="../js/axios.min.js"></script>
    <!-- 这里引入外部文件的字体图标样式 -->
    <link rel="stylesheet" href="../css/iconfont.css" />
    <style type="text/css">
        .search {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .groudInfo img {
            width: 8rem;
            height: 10rem;
            margin-left: 1rem;
            margin-right: 0.3rem;
            border-radius: 1.5rem;
            vertical-align: top;
        }

        .groudInfo li {
            margin-bottom: 1.5rem;
            border-bottom: 0.1rem solid #eee;
        }

        .groudInfo .content {
            position: relative;
            display: inline-block;
            width: 11rem;
        }

        .groudInfo .content h4 {
            margin: 0.2rem 0;
        }

        .groudInfo .content p {
            margin: 0.1rem 0;
            height: 2.7rem;
            font-size: 15px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .groudInfo .content .prize {
            color: red;
            font-size: 1.3rem;
        }

        .groudInfo .content .want {
            float: right;
            margin-top: 0.6rem;
            color:gray;
            font-size: 0.5rem;
        }

        .groudInfo .content .publisherHead {
            position: absolute;
            top: 7.3rem;
            left: -1rem;
            width: 2rem;
            height: 2rem;
            border-radius: 2rem;
        }

        .groudInfo .content .publishName {
            font-size: 0.2rem;
            position: absolute;
            top: 8rem;
            left: 2.2rem;
        }

        .groudInfo .content .credit {
            font-size: 0.1rem;
            position: absolute;
            right: 0;
            top: 8rem;
        }

        .footer {
            height: 2rem;
        }

        .groudInfo .get {
            margin-left: 0.5rem;
            display: inline-block;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="search">
            <van-search v-model="searchValue" placeholder="请输入搜索关键词" shape="round" />
        </div>
        <div class="groudInfo">
            <ul>
                <li v-for="(item,index) in vagueSearchList" :key=item>
                    <img :src="item.imgurl[0]">
                    <div class="content">
                        <h4>{{item.good}}</h4>
                        <p>{{item.info}}</p>
                        <span class="prize">￥{{item.prize}}</span>
                        <span class="want">{{item.want}}人想要</span>
                        <img class="publisherHead" :src="item.publisher.headurl">
                        <span class="publishName">{{item.publisher.name}}</span>
                        <div class="credit">
                            <van-icon name="fire" color="#1D82FE"/>
                            <span>信用{{item.publisher.credit}}</span>
                        </div>
                    </div>
                    <div class="get">
                        <van-button color="linear-gradient(to right, #FE5C33, #EF0F25)" round>购买</van-button>
                    </div>
                </li>
            </ul>
        </div>
        <div class="footer">
            <van-tabbar v-model="tabActive" active-color="#DF5523" @change="tabChange">
                <van-tabbar-item :icon="fleaIcon">跳蚤</van-tabbar-item>
                <van-tabbar-item :icon="publishIcon" @click="goToPublish">发布</van-tabbar-item>
                <van-tabbar-item :icon="shopcarIcon" @click="goToShopcar">购物车</van-tabbar-item>
                <van-tabbar-item :icon="meIcon" @click="goToMe">我的</van-tabbar-item>
            </van-tabbar>
        </div>

    </div>
</body>
<script>
    let vm = new Vue({
        el: '#app',
        data: {
            searchValue: "",
            tabActive: 0,
            fleaIcon: "hot",
            publishIcon: "share-o",
            shopcarIcon: "shopping-cart-o",
            meIcon: "manager-o",
            groudList: []
        },
        computed: {
            // 模糊查询
            vagueSearchList: function () {
                return this.groudList.filter(item => item.good.includes(this.searchValue));
            }
        },
        methods: {
            // 当点击的标签出现变化时，判断是哪一个标签，并把样式修改一下
            tabChange: function () {
                switch (this.tabActive) {
                    case 0: {
                        this.fleaIcon = "hot";
                        this.publishIcon = "share-o";
                        this.shopcarIcon = "shopping-cart-o";
                        this.meIcon = "manager-o";
                        break;
                    };
                    case 1: {
                        this.fleaIcon = "hot-o";
                        this.publishIcon = "share";
                        this.shopcarIcon = "shopping-cart-o";
                        this.meIcon = "manager-o";
                        break;
                    };
                    case 2: {
                        this.fleaIcon = "hot-o";
                        this.publishIcon = "share-o";
                        this.shopcarIcon = "shopping-cart";
                        this.meIcon = "manager-o";
                        break;
                    };
                    case 3: {
                        this.fleaIcon = "hot-o";
                        this.publishIcon = "share-o";
                        this.shopcarIcon = "shopping-cart-o";
                        this.meIcon = "manager";
                        break;
                    }
                }
            },
            goToPublish: function(){
                window.location.href = "./publish.html";
            },
            goToShopcar: function(){
                window.location.href = "./shopcar.html";
            },
            goToMe: function(){
                window.location.href = "./me.html";
            }
        },
        beforeMount: function () {
            vant.Toast.loading({
                message: '加载中...',
                forbidClick: true,
            });
        },
        mounted: function () {
            axios.get("http://localhost:5502/getGroundInfo").then(res => {
                vant.Toast.clear;
                this.groudList = res.data.reverse();
            })
        }
    })
</script>

</html>